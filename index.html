<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Statement Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .animate-slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .gradient-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .gradient-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .gradient-button-green {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .gradient-button-red {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        
        .metric-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .chat-message {
            animation: slideIn 0.3s ease-out;
        }
        
        .loading-pulse {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        .health-score-ring {
            transition: stroke-dashoffset 1s ease-out;
        }
        
        body {
            background: #0a0e1a;
        }
        
        .upload-zone {
            border: 2px dashed rgba(148, 163, 184, 0.3);
            transition: all 0.3s ease;
        }
        
        .upload-zone:hover {
            border-color: rgba(102, 126, 234, 0.6);
            background: rgba(102, 126, 234, 0.05);
        }
        
        .upload-zone.drag-over {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Set up PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        function FinancialAnalyzer() {
            const [file, setFile] = useState(null);
            const [extractedText, setExtractedText] = useState('');
            const [loading, setLoading] = useState(false);
            const [analysis, setAnalysis] = useState(null);
            const [riskTolerance, setRiskTolerance] = useState(5);
            const [growthExpectation, setGrowthExpectation] = useState(5);
            const [chatMessages, setChatMessages] = useState([]);
            const [chatInput, setChatInput] = useState('');
            const [chatLoading, setChatLoading] = useState(false);
            const [dragOver, setDragOver] = useState(false);
            const chatEndRef = useRef(null);

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [chatMessages]);

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragOver(true);
            };

            const handleDragLeave = () => {
                setDragOver(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                const droppedFile = e.dataTransfer.files[0];
                if (droppedFile) {
                    handleFileSelect(droppedFile);
                }
            };

            const extractTextFromPDF = async (file) => {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                    let fullText = '';

                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        fullText += pageText + '\n';
                    }

                    return fullText;
                } catch (error) {
                    console.error('PDF extraction error:', error);
                    throw new Error('Failed to extract text from PDF. The file may be corrupted or password-protected.');
                }
            };

            const extractTextFromDocx = async (file) => {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer });
                    return result.value;
                } catch (error) {
                    console.error('DOCX extraction error:', error);
                    throw new Error('Failed to extract text from DOCX file. The file may be corrupted.');
                }
            };

            const extractTextFromExcel = async (file) => {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                    let fullText = '';

                    workbook.SheetNames.forEach(sheetName => {
                        const sheet = workbook.Sheets[sheetName];
                        const csv = XLSX.utils.sheet_to_csv(sheet);
                        fullText += `Sheet: ${sheetName}\n${csv}\n\n`;
                    });

                    return fullText;
                } catch (error) {
                    console.error('Excel extraction error:', error);
                    throw new Error('Failed to extract data from Excel file. The file may be corrupted or in an unsupported format.');
                }
            };

            const handleFileSelect = async (selectedFile) => {
                if (!selectedFile) return;
                
                setFile(selectedFile);
                setLoading(true);
                setAnalysis(null);
                setChatMessages([]);
                setExtractedText('');

                try {
                    let text = '';
                    const fileName = selectedFile.name.toLowerCase();

                    if (fileName.endsWith('.pdf')) {
                        text = await extractTextFromPDF(selectedFile);
                    } else if (fileName.endsWith('.docx') || fileName.endsWith('.doc')) {
                        text = await extractTextFromDocx(selectedFile);
                    } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                        text = await extractTextFromExcel(selectedFile);
                    } else if (fileName.endsWith('.csv')) {
                        text = await selectedFile.text();
                    } else if (fileName.endsWith('.txt')) {
                        text = await selectedFile.text();
                    } else if (fileName.endsWith('.xbrl') || fileName.endsWith('.xml')) {
                        text = await selectedFile.text();
                    } else {
                        throw new Error('Unsupported file format. Please use PDF, DOCX, XLSX, CSV, TXT, or XML files.');
                    }

                    if (!text || text.trim().length < 100) {
                        throw new Error('Could not extract enough text from the document. Please ensure the file contains readable text.');
                    }

                    setExtractedText(text);
                    await analyzeDocument(text);
                } catch (error) {
                    console.error('Error processing file:', error);
                    setLoading(false);
                    setFile(null);
                    alert(error.message || 'Error processing file. Please try another file or format.');
                }
            };

            const analyzeDocument = async (text) => {
                try {
                    const prompt = `Analyze this financial statement and provide a JSON response with the following structure. Extract actual numbers from the document where available:

{
  "companyName": "extracted company name or 'Unknown Company'",
  "healthScore": number between 0-100 based on financial metrics,
  "metrics": {
    "revenue": "actual value with currency or 'Not specified'",
    "profit": "actual value with currency or 'Not specified'",
    "assets": "actual value with currency or 'Not specified'",
    "debt": "actual value with currency or 'Not specified'",
    "currentRatio": "calculated ratio or 'N/A'",
    "debtToEquity": "calculated ratio or 'N/A'",
    "profitMargin": "percentage or 'N/A'"
  },
  "insights": [
    "First key insight about financial health in plain English",
    "Second key insight about performance or trends",
    "Third key insight about risks or opportunities"
  ],
  "detailedAnalysis": "A brief comprehensive analysis of the company's financial position"
}

Financial Statement Text (first 15000 characters):
${text.substring(0, 15000)}

CRITICAL INSTRUCTIONS:
1. Respond ONLY with valid JSON - no other text before or after
2. Use actual numbers from the document when available
3. If data is missing, use "Not specified" or "N/A"
4. Calculate the health score based on available metrics
5. Make insights specific and actionable`;

                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "x-api-key": "YOUR_API_KEY_HERE",
                            "anthropic-version": "2023-06-01"
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 2500,
                            messages: [
                                { role: "user", content: prompt }
                            ]
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status: ${response.status}`);
                    }

                    const data = await response.json();
                    let responseText = data.content[0].text;
                    
                    // Clean up response - remove markdown code blocks
                    responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
                    
                    // Try to parse the JSON
                    let analysisData;
                    try {
                        analysisData = JSON.parse(responseText);
                    } catch (parseError) {
                        // If parsing fails, try to extract JSON from the response
                        const jsonMatch = responseText.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            analysisData = JSON.parse(jsonMatch[0]);
                        } else {
                            throw new Error('Could not parse analysis results');
                        }
                    }
                    
                    // Validate the response has required fields
                    if (!analysisData.companyName || !analysisData.healthScore || !analysisData.metrics || !analysisData.insights) {
                        throw new Error('Invalid analysis response structure');
                    }
                    
                    setAnalysis(analysisData);
                } catch (error) {
                    console.error('Error analyzing document:', error);
                    alert('Error analyzing document: ' + error.message + '. Please try again or use a different document.');
                    setFile(null);
                    setExtractedText('');
                } finally {
                    setLoading(false);
                }
            };

            const getInvestmentRecommendation = () => {
                if (!analysis || !analysis.healthScore) return null;

                const score = Number(analysis.healthScore) || 0;
                const risk = Number(riskTolerance) || 5;
                const growth = Number(growthExpectation) || 5;

                // Calculate recommendation based on health score, risk tolerance, and growth expectations
                let recommendation = '';
                let color = '';
                let action = '';

                if (score >= 80) {
                    if (risk >= 7 && growth >= 7) {
                        recommendation = 'Strong Buy';
                        color = 'text-green-400';
                        action = 'INVEST';
                    } else if (risk >= 4) {
                        recommendation = 'Buy';
                        color = 'text-green-400';
                        action = 'INVEST';
                    } else {
                        recommendation = 'Conservative Buy';
                        color = 'text-green-500';
                        action = 'INVEST';
                    }
                } else if (score >= 60) {
                    if (risk >= 8 && growth >= 8) {
                        recommendation = 'Moderate Buy';
                        color = 'text-green-500';
                        action = 'INVEST';
                    } else if (risk >= 5 && growth >= 5) {
                        recommendation = 'Hold/Watch';
                        color = 'text-yellow-400';
                        action = 'WAIT';
                    } else {
                        recommendation = 'Pass';
                        color = 'text-orange-400';
                        action = 'PASS';
                    }
                } else if (score >= 40) {
                    if (risk >= 9 && growth >= 8) {
                        recommendation = 'Speculative Buy';
                        color = 'text-yellow-500';
                        action = 'CAUTION';
                    } else if (risk >= 6) {
                        recommendation = 'High Risk - Caution';
                        color = 'text-orange-400';
                        action = 'PASS';
                    } else {
                        recommendation = 'Avoid';
                        color = 'text-red-400';
                        action = 'AVOID';
                    }
                } else {
                    if (risk >= 9 && growth >= 9) {
                        recommendation = 'Very High Risk Only';
                        color = 'text-red-400';
                        action = 'AVOID';
                    } else {
                        recommendation = 'Do Not Invest';
                        color = 'text-red-500';
                        action = 'AVOID';
                    }
                }

                return { recommendation, color, action };
            };

            const sendChatMessage = async () => {
                if (!chatInput.trim() || !extractedText) return;

                const userMessage = chatInput;
                setChatInput('');
                
                // Add user message immediately
                const newUserMessage = { role: 'user', content: userMessage };
                setChatMessages(prev => [...prev, newUserMessage]);
                setChatLoading(true);

                try {
                    // Build conversation history for API
                    const apiMessages = [];
                    
                    // Add context about the financial statement
                    apiMessages.push({
                        role: "user",
                        content: `You are a financial analyst assistant. I will share a financial statement with you, and then ask questions about it. Answer in simple, plain English. Be helpful and explain financial concepts clearly.

Here is the financial statement data:
${extractedText.substring(0, 12000)}`
                    });
                    
                    apiMessages.push({
                        role: "assistant",
                        content: "I've reviewed the financial statement. I'm ready to answer your questions about it in simple, plain English."
                    });
                    
                    // Add conversation history
                    chatMessages.forEach(msg => {
                        apiMessages.push({
                            role: msg.role === 'user' ? 'user' : 'assistant',
                            content: msg.content
                        });
                    });
                    
                    // Add current user message
                    apiMessages.push({
                        role: "user",
                        content: userMessage
                    });

                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "x-api-key": "YOUR_API_KEY_HERE",
                            "anthropic-version": "2023-06-01"
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1500,
                            messages: apiMessages
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status}`);
                    }

                    const data = await response.json();
                    const assistantResponse = data.content[0].text;

                    setChatMessages(prev => [...prev, { role: 'assistant', content: assistantResponse }]);
                } catch (error) {
                    console.error('Error in chat:', error);
                    setChatMessages(prev => [...prev, { role: 'assistant', content: 'Sorry, I encountered an error. Please try again.' }]);
                } finally {
                    setChatLoading(false);
                }
            };

            const HealthScoreRing = ({ score }) => {
                // Ensure score is a valid number between 0-100
                const validScore = Math.max(0, Math.min(100, Number(score) || 0));
                
                const circumference = 2 * Math.PI * 45;
                const offset = circumference - (validScore / 100) * circumference;
                
                let color = '#ef4444';
                if (validScore >= 70) color = '#22c55e';
                else if (validScore >= 50) color = '#eab308';
                else if (validScore >= 30) color = '#f97316';

                return (
                    <div className="relative w-32 h-32">
                        <svg className="transform -rotate-90 w-32 h-32">
                            <circle
                                cx="64"
                                cy="64"
                                r="45"
                                stroke="#1e293b"
                                strokeWidth="8"
                                fill="none"
                            />
                            <circle
                                className="health-score-ring"
                                cx="64"
                                cy="64"
                                r="45"
                                stroke={color}
                                strokeWidth="8"
                                fill="none"
                                strokeDasharray={circumference}
                                strokeDashoffset={offset}
                                strokeLinecap="round"
                            />
                        </svg>
                        <div className="absolute inset-0 flex items-center justify-center">
                            <div className="text-center">
                                <div className="text-3xl font-bold text-white">{validScore}</div>
                                <div className="text-xs text-gray-400">Score</div>
                            </div>
                        </div>
                    </div>
                );
            };

            const investmentRec = getInvestmentRecommendation();

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-12 animate-fade-in">
                            <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                                Financial Statement Analyzer
                            </h1>
                            <p className="text-gray-400 text-lg">Upload any financial document for instant AI-powered analysis</p>
                        </div>

                        {/* Upload Section */}
                        {!file && (
                            <div className="animate-slide-in">
                                <div 
                                    className={`upload-zone rounded-2xl p-12 text-center cursor-pointer ${dragOver ? 'drag-over' : ''}`}
                                    onDragOver={handleDragOver}
                                    onDragLeave={handleDragLeave}
                                    onDrop={handleDrop}
                                    onClick={() => document.getElementById('fileInput').click()}
                                >
                                    <div className="mb-6">
                                        <svg className="w-20 h-20 mx-auto text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                        </svg>
                                    </div>
                                    <h3 className="text-2xl font-semibold mb-2">Drop your financial statement here</h3>
                                    <p className="text-gray-400 mb-6">or click to browse</p>
                                    <div className="inline-block bg-slate-800/50 rounded-lg px-4 py-2 border border-slate-700">
                                        <p className="text-sm text-gray-400">
                                            <span className="text-purple-400 font-semibold">Supported formats:</span> PDF, DOCX, XLSX, XLS, CSV, TXT, XBRL, XML
                                        </p>
                                    </div>
                                    <input
                                        id="fileInput"
                                        type="file"
                                        className="hidden"
                                        accept=".pdf,.docx,.doc,.xlsx,.xls,.csv,.txt,.xbrl,.xml"
                                        onChange={(e) => handleFileSelect(e.target.files[0])}
                                    />
                                </div>
                            </div>
                        )}

                        {/* Loading State */}
                        {loading && (
                            <div className="text-center py-20 animate-fade-in">
                                <div className="loading-pulse text-6xl mb-6">üìä</div>
                                <p className="text-2xl text-gray-200 mb-3 font-semibold">Analyzing Financial Statement</p>
                                <p className="text-gray-400">Extracting data and calculating metrics...</p>
                                <div className="mt-8 flex justify-center gap-2">
                                    <div className="w-3 h-3 bg-purple-500 rounded-full animate-bounce"></div>
                                    <div className="w-3 h-3 bg-pink-500 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                                    <div className="w-3 h-3 bg-purple-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                                </div>
                            </div>
                        )}

                        {/* Analysis Dashboard */}
                        {analysis && !loading && (
                            <div className="space-y-8 animate-slide-in">
                                {/* Company Header */}
                                <div className="bg-gradient-to-r from-purple-900/30 to-pink-900/30 rounded-2xl p-8 border border-purple-500/20">
                                    <div className="flex items-center justify-between flex-wrap gap-6">
                                        <div>
                                            <h2 className="text-4xl font-bold mb-2">{analysis.companyName}</h2>
                                            <p className="text-gray-400">Financial Health Analysis</p>
                                        </div>
                                        <HealthScoreRing score={analysis.healthScore} />
                                    </div>
                                </div>

                                {/* Key Metrics Grid */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    {analysis.metrics && Object.entries(analysis.metrics).map(([key, value], idx) => (
                                        <div 
                                            key={key} 
                                            className="metric-card rounded-xl p-6 card-hover"
                                            style={{ animationDelay: `${idx * 0.1}s` }}
                                        >
                                            <div className="text-gray-400 text-sm uppercase tracking-wider mb-2">
                                                {key.replace(/([A-Z])/g, ' $1').trim()}
                                            </div>
                                            <div className="text-2xl font-bold text-white">{value || 'N/A'}</div>
                                        </div>
                                    ))}
                                </div>

                                {/* Insights */}
                                <div className="bg-slate-800/50 rounded-2xl p-8 border border-slate-700">
                                    <h3 className="text-2xl font-bold mb-6 flex items-center">
                                        <span className="mr-3">üí°</span>
                                        Key Insights
                                    </h3>
                                    <div className="space-y-4">
                                        {analysis.insights && Array.isArray(analysis.insights) && analysis.insights.map((insight, idx) => (
                                            <div key={idx} className="flex items-start animate-slide-in" style={{ animationDelay: `${idx * 0.15}s` }}>
                                                <span className="text-purple-400 font-bold mr-3">{idx + 1}.</span>
                                                <p className="text-gray-300 leading-relaxed">{insight}</p>
                                            </div>
                                        ))}
                                        {(!analysis.insights || !Array.isArray(analysis.insights) || analysis.insights.length === 0) && (
                                            <p className="text-gray-400 italic">No insights available</p>
                                        )}
                                    </div>
                                </div>

                                {/* Investment Recommendation Section */}
                                <div className="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-2xl p-8 border border-slate-700">
                                    <h3 className="text-2xl font-bold mb-6 flex items-center">
                                        <span className="mr-3">üéØ</span>
                                        Investment Recommendation
                                    </h3>
                                    
                                    {/* Risk & Growth Sliders */}
                                    <div className="grid md:grid-cols-2 gap-6 mb-8">
                                        <div>
                                            <label className="block text-sm text-gray-400 mb-3">
                                                Risk Tolerance: <span className="text-white font-semibold">{riskTolerance}/10</span>
                                            </label>
                                            <input
                                                type="range"
                                                min="1"
                                                max="10"
                                                value={riskTolerance}
                                                onChange={(e) => setRiskTolerance(parseInt(e.target.value))}
                                                className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"
                                                style={{
                                                    background: `linear-gradient(to right, #667eea 0%, #667eea ${riskTolerance * 10}%, #334155 ${riskTolerance * 10}%, #334155 100%)`
                                                }}
                                            />
                                            <div className="flex justify-between text-xs text-gray-500 mt-1">
                                                <span>Conservative</span>
                                                <span>Aggressive</span>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm text-gray-400 mb-3">
                                                Growth Expectation: <span className="text-white font-semibold">{growthExpectation}/10</span>
                                            </label>
                                            <input
                                                type="range"
                                                min="1"
                                                max="10"
                                                value={growthExpectation}
                                                onChange={(e) => setGrowthExpectation(parseInt(e.target.value))}
                                                className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"
                                                style={{
                                                    background: `linear-gradient(to right, #764ba2 0%, #764ba2 ${growthExpectation * 10}%, #334155 ${growthExpectation * 10}%, #334155 100%)`
                                                }}
                                            />
                                            <div className="flex justify-between text-xs text-gray-500 mt-1">
                                                <span>Stable</span>
                                                <span>High Growth</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Recommendation Result */}
                                    {investmentRec && (
                                        <div className="bg-slate-900/50 rounded-xl p-6 border border-slate-600">
                                            <div className="flex items-center justify-between flex-wrap gap-4">
                                                <div>
                                                    <div className="text-sm text-gray-400 mb-1">Recommendation</div>
                                                    <div className={`text-3xl font-bold ${investmentRec.color}`}>
                                                        {investmentRec.recommendation}
                                                    </div>
                                                </div>
                                                <div>
                                                    {investmentRec.action === 'INVEST' && (
                                                        <button className="gradient-button-green text-white px-8 py-4 rounded-xl font-semibold text-lg">
                                                            ‚úì INVEST
                                                        </button>
                                                    )}
                                                    {investmentRec.action === 'WAIT' && (
                                                        <button className="bg-yellow-600 hover:bg-yellow-700 text-white px-8 py-4 rounded-xl font-semibold text-lg transition">
                                                            ‚è∏ WAIT
                                                        </button>
                                                    )}
                                                    {investmentRec.action === 'PASS' && (
                                                        <button className="bg-orange-600 hover:bg-orange-700 text-white px-8 py-4 rounded-xl font-semibold text-lg transition">
                                                            ‚äò PASS
                                                        </button>
                                                    )}
                                                    {investmentRec.action === 'AVOID' && (
                                                        <button className="gradient-button-red text-white px-8 py-4 rounded-xl font-semibold text-lg">
                                                            ‚úó AVOID
                                                        </button>
                                                    )}
                                                    {investmentRec.action === 'CAUTION' && (
                                                        <button className="bg-yellow-700 hover:bg-yellow-800 text-white px-8 py-4 rounded-xl font-semibold text-lg transition">
                                                            ‚ö† CAUTION
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* AI Chat Assistant */}
                                <div className="bg-slate-800/50 rounded-2xl border border-slate-700 overflow-hidden">
                                    <div className="bg-gradient-to-r from-purple-900/50 to-pink-900/50 p-6 border-b border-slate-700">
                                        <h3 className="text-2xl font-bold flex items-center">
                                            <span className="mr-3">ü§ñ</span>
                                            AI Financial Assistant
                                        </h3>
                                        <p className="text-gray-400 text-sm mt-1">Ask me anything about this financial statement</p>
                                    </div>
                                    
                                    <div className="h-96 overflow-y-auto p-6 space-y-4">
                                        {chatMessages.length === 0 && (
                                            <div className="text-center text-gray-500 py-12">
                                                <p className="text-lg">Start a conversation! Ask me about:</p>
                                                <div className="mt-4 space-y-2 text-sm">
                                                    <p>‚Ä¢ Revenue trends and growth</p>
                                                    <p>‚Ä¢ Profitability and margins</p>
                                                    <p>‚Ä¢ Debt levels and financial health</p>
                                                    <p>‚Ä¢ Investment risks and opportunities</p>
                                                </div>
                                            </div>
                                        )}
                                        
                                        {chatMessages.map((msg, idx) => (
                                            <div
                                                key={idx}
                                                className={`chat-message flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                                            >
                                                <div
                                                    className={`max-w-[80%] rounded-xl p-4 ${
                                                        msg.role === 'user'
                                                            ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white'
                                                            : 'bg-slate-700 text-gray-100'
                                                    }`}
                                                >
                                                    <p className="leading-relaxed">{msg.content}</p>
                                                </div>
                                            </div>
                                        ))}
                                        
                                        {chatLoading && (
                                            <div className="flex justify-start">
                                                <div className="bg-slate-700 rounded-xl p-4">
                                                    <div className="flex space-x-2">
                                                        <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce"></div>
                                                        <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                                                        <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        <div ref={chatEndRef} />
                                    </div>
                                    
                                    <div className="p-6 bg-slate-900/50 border-t border-slate-700">
                                        <div className="flex gap-3">
                                            <input
                                                type="text"
                                                value={chatInput}
                                                onChange={(e) => setChatInput(e.target.value)}
                                                onKeyDown={(e) => {
                                                    if (e.key === 'Enter' && !e.shiftKey) {
                                                        e.preventDefault();
                                                        sendChatMessage();
                                                    }
                                                }}
                                                placeholder="Ask about revenue, profits, risks..."
                                                className="flex-1 bg-slate-800 text-white rounded-xl px-6 py-3 border border-slate-600 focus:outline-none focus:border-purple-500 transition"
                                                disabled={chatLoading}
                                            />
                                            <button
                                                onClick={sendChatMessage}
                                                disabled={chatLoading || !chatInput.trim()}
                                                className="gradient-button text-white px-8 py-3 rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                Send
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Reset Button */}
                                <div className="text-center">
                                    <button
                                        onClick={() => {
                                            setFile(null);
                                            setAnalysis(null);
                                            setExtractedText('');
                                            setChatMessages([]);
                                        }}
                                        className="bg-slate-700 hover:bg-slate-600 text-white px-8 py-3 rounded-xl font-semibold transition"
                                    >
                                        Analyze Another Document
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<FinancialAnalyzer />, document.getElementById('root'));
    </script>
</body>
</html>
